{% extends 'frame.html' %}
{% block content %}
    {% load static %}
    {% load crispy_forms_tags %}
    <div class="masthead">
        <div class="container">
            <div class="row g-0">
                <div class="col-md-6 masthead-text">
                    <!-- Post title goes in these h1 tags -->
                    <h1 class="post-title">{{ problem.title }}</h1>
                    <!-- Post author goes before the | the post's created date goes after -->
                    <p class="post-subtitle">{{ problem.author }} | {{ problem.created_date }}</p>
                </div>
                <div class="d-none d-md-block col-md-6 masthead-image">
                    <img src="{% static 'images/default.jpg' %}"
                         class="scale"
                         alt="placeholder">
                </div>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="col card mb-4  mt-3 left  top">
                <div class="card-body">
                    <!-- The post content goes inside the card-text. -->
                    <!-- Use the | safe filter inside the template tags -->
                    <div class="card-text">{{ problem.description | safe }}</div>
                    <h2 class="p-3">Current Workaround</h2>
                    <div class="card-text">{{ problem.workaround | safe }}</div>
                </div>
            </div>
        </div>
        <!-- Displaying count of comments -->
        <div class="row">
            <div class="col-12">
                <strong class="text-secondary">
                    <i class="far fa-comments"></i> {{ takes_count }}
                </strong>
            </div>
            <div class="col-12">
                <hr>
            </div>
        </div>
        <!-- Displaying Comments -->
        <div class="row">
            <div class="col-md-8 card mb-4  mt-3 ">
                <h3>Takes:</h3>
                <div class="card-body">
                    <!-- We want a for loop inside the empty control tags
                         to iterate through each comment in comments -->
                    {% for take in takes %}
                        <div class="p-2 comments {% if not take.status == 'public' and take.author == user %} faded{% elif not take.status == 'public' %} d-none{% endif %}">
                            <p class="font-weight-bold">
                                {{ take.author }}
                                <span class="font-weight-normal">{{ take.created_date }}</span> wrote:
                            </p>
                            <div id="take{{ take.id }}">{{ take.description | linebreaks }}</div>
                            {% if not take.status == 'public' and take.author == user %}
                                <p class="approval">This take is awaiting approval</p>
                            {% endif %}
                            {% if user.is_authenticated and take.author == user %}
                                <button class="btn btn-delete" data-take_id="{{ take.id }}">Delete</button>
                                <button class="btn btn-edit" data-take_id="{{ take.id }}">Edit</button>
                            {% endif %}
                        </div>
                        <!-- Our for loop ends here -->
                    {% endfor %}
                </div>
            </div>
            <!-- Creating New Comments -->
            <div class="col-md-4 card mb-4 mt-3">
                <div class="card-body">
                    {% if user.is_authenticated %}
                        <h3>Leave a Take:</h3>
                        <p>Posting as: {{ user.username }}</p>
                        <form id="takeForm" method="post" style="margin-top: 1.3em;">
                            {{ take_form | crispy }}
                            {% csrf_token %}
                            <button id="submitButton" type="submit" class="btn btn-signup btn-lg">Submit</button>
                        </form>
                    {% else %}
                        <p>Log in to leave a Take</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    <!-- Delete confirmation modal -->
    <div class="modal fade"
         id="deleteModal"
         tabindex="-1"
         aria-labelledby="deleteModalLabel"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel">Delete take?</h5>
                    <button type="button"
                            class="btn-close"
                            data-bs-dismiss="modal"
                            aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete your take?
                    This action cannot be undone.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <a id="deleteConfirm" href="#" class="btn btn-danger">Delete</a>
                </div>
            </div>
        </div>
    </div>
{% endblock content %}
{% block extras %}
    <script src="{% static 'js/takes.js' %}"></script>
{% endblock extras %}
